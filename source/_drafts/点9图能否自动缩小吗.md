---
title: 点9图能否自动缩小吗
tags:
  - android
  - ui
---

# 介绍
来自[官方][ref2]的介绍。

`NinePatchDrawable`图像是可拉伸的位图，当作为View的背景时Android会自动调整其大小以适应View的内容。

# 案例

蓝色区域返回`getHeight()`返回245

蓝色区域使用的点九图 ![](bg_homepage_auth_container.9.png)

点9图的高度是165


----

# NinePatch
## 数据结构
byte[] chunk数据格式

[来源][ref2]

byte[] chunk数据用于构构造[Res_png_9patch][Res_png_9patch]结构体。

## 如何构造chunk
[参考][ref3]。这个帖子中的需求很有意思：自定义UI，有些色值和图片是从服务器下载的。而且某些图片是NinePatch图。那么如何从这些NinePatch图片生成NinePatchDrawable呢？

1. 创建NinePatchDrawable前需要先创建NinePatch或byte[] chunk数据
2. 

## 关于chunk
Android有两种格式的NinePatch文件，分别是源文件和编译后的文件。源文件是你添加了1像素透明边框的那种，见[官方文档][ref4]。当你将资源和代码编译成apk时，`aapt`工具会将所有的`*.9.png`图片编译成Android期望的格式。即PNG图片中的"chunk"元数据。

注：参考自[这里][ref3]

[Apktool的wiki][ref5]中讨论了NinePatch格式的问题。引下几段来自该处

官方文档中没有关于9patch的源文件和编译格式的说明，而这很关键。

+ source - 源文件。简单来说，就是那种边上有黑线的那种图片
+ compiled - 比较神秘不为人所知。图片上没有黑色边框，而9patch数据被写入称为`npTc`字段中。无法轻易地看到和修改这个数据。但Android自己可以处理该数据

所以有几个相关的问题。

+ 两种格式间需要转换。如果从apk中解压9patch图片，然后直接作为源文件，编译apk时会出错的。反之亦然，不能直接把源文件形式的9patch图片放到apk中
+ 9patch图片的chunk字段并不能被图片处理工具识别。所以修改编译后的9patch图很可能破坏`npTc`，随之损坏整个9patch图

解决这个问题的办法就是提供两种格式间方便的转换方案。编码器(将源文件转换成编译后的文件)已内置到aapt工具中，会在编译apk时自动处理源文件。所以只需要构建一个解码器即可。apktool v1.3.0中

`Bitmap.getNinePatchChunk()`可以用来获取Bitmap中的chunk字段。



---



[ref1]: http://blog.csdn.net/hudashi/article/details/6957160
[ref2]: https://developer.android.com/guide/topics/graphics/2d-graphics.html#nine-patch
[Res_png_9patch]: http://android.git.kernel.org/?p=platform/frameworks/base.git;a=blob;f=incl?/utils/ResourceTypes.h
[ref3]: http://stackoverflow.com/questions/5079868/create-a-ninepatch-ninepatchdrawable-in-runtime
[ref4]: https://developer.android.com/guide/topics/graphics/2d-graphics.html#nine-patch
[ref5]: https://ibotpeaches.github.io/Apktool/documentation/#9patch-images