

分类：经验

[原文](http://blog.jobbole.com/28672/)

原文链接： [Niklas Frykholm][Niklas Frykholm]   翻译： [伯乐在线][伯乐在线] - [唐小娟][唐小娟] 
译文链接： [http://blog.jobbole.com/28672/](http://blog.jobbole.com/28672/)

[Niklas Frykholm]: http://bitsquid.blogspot.com/2012/08/cleaning-bad-code.html
[伯乐在线]: http://blog.jobbole.com/
[唐小娟]: http://blog.jobbole.com/author/tangxiaojuan/

非常不错的经验。对比自己做项目，思考：

第1条：有时没做到  
第2条：能做到  
第3条：想做，但做得不好  
第4条：能做到  
第5条：基本做到  
第6条：
第7条：做得不好
第8条：理解还不深刻

## 1. 建立测试用例
单元测试是最好的，但是所有的代码并不适应单元测试。

## 2. 使用版本控制

## 3. 每次仅仅做一个小小的改动
有两种方法改进坏的代码：革命和改革。革命是用火把一切都烧掉，从新写一遍。改革是在不破坏的基础上每次只进行一点小小的改变。

一次只做一个小的改变，测试它，并且commit它。当一个改变很小时，它更容易理解改动的后果以及确保改动不会影响现有的功能。

如果什么地方出错了，你仅仅需要核查很少的一部分代码。

如果你开始做更改并且意识到改得很糟糕，那么你恢复到上一次的commit，不会损失太多的无用功。

不要一次进行多处更改。

# 4. 不要同时清理代码和修正代码
清理代码和修正错误是完全不同的目标。

当你清理的势后，你想让代码看起来更好，而没有改变它的功能。

当你修正错误时， 你想改变功能。如果你同时清理代码和改正错误，很难保证清理不会改变什么。

先清理代码，然后再在一个干净的基础上，加入新的功能。

# 5. 删除你没有使用的功能
如果代码的功能你目前没有使用，而且在可预见的将来也不会使用，那么就删除它，这会减少你浏览的代码数，降低复杂度（删除不必要的概念和依赖）。

# 6. 删除大部分注释

# 7. 避免共享的可更改的状态
共享的可更改的状态是理解代码的最大阻碍。

共享的可更改的状态来自于：

+ 全局变量。全局常量并不糟糕， 唯一会造成问题的是共享的可更改状态的全局变量。
+ 对象。当一个对象有越来越多的成员时，问题就越来越严重。
+ 巨大的函数。
+ 引用和指针参数。没有被声明为const引用和指针参数被传进函数时，可以在被调用者，调用者以及任何能被传递相同的指针的对象之间充当共享的可变的状态。

针对以上问题的建议：

+ 将较大的函数切分成较小的函数。
+ 将较大的对象切分成较小的变量。
+ 将成员变成private
+ 将函数声明const，返回结果，而不是可更改的状态
+ 将函数声明static，从参数获得值，而不是从共享状态那里取值

# 8. 避免不必要的复杂性
不必要的复杂性通常是过度工程化的结果

有时候过工程化是因为一些项目开始的时候有一些更大的野心，多于实际完成的。

治愈过度工程化的方法就是YAGNI(you are not gonna need it)-你不需要它！只有当需要一个东西的时候才建造它。当你需要它的时候才建立更复杂的东西，而不是在你需要之前。